Break at \*0xffffffff82855469

(kgdb) p &data
$11 = (char (\*)[2048]) 0xfffffe005191a1a0
(kgdb) p/x $rbp - 0xb20
$12 = 0xfffffe005191a1a0 (kgdb) info frame
Stack level 0, frame at 0xfffffe005191acd0:
rip = 0xffffffff82855469 in ipf_sync_write (/usr/src/sys/netpfil/ipfilter/netinet/ip_sync.c:511);
saved rip = 0xffffffff80af5b26 called by frame at 0x4141414141414151
source language c.
Arglist at 0xfffffe005191acc0, args: softc=0xfffffe00708df500, uio=0xfffffe005191ada8
Locals at 0xfffffe005191acc0, Previous frame's sp is 0xfffffe005191acd0
Saved registers:
rbx at 0xfffffe005191ac98, rbp at 0xfffffe005191acc0, r12 at 0xfffffe005191aca0,
r13 at 0xfffffe005191aca8, r14 at 0xfffffe005191acb0, r15 at 0xfffffe005191acb8,
rip at 0xfffffe005191acc8
(kgdb) p/x $rbp
$13 = 0xfffffe005191acc0
(kgdb) p/x $rsp
$14 = 0xfffffe005191a120
(kgdb) info locals
sh = {sm_magic = 267722213, sm_v = 4 '\004', sm_p = 4 '\004', sm_cmd = 0 '\000',
sm_table = 0 '\000', sm_num = 0, sm_rev = 0, sm_len = 2864, sm_sl = 0x0}
data = 'A' <repeats 992 times>...
softs = 0xfffff80003bae780
err = 0
(kgdb) info args
softc = 0xfffffe00708df500
uio = 0xfffffe005191ada8
(kgdb)

# Raw memory around the frame

## Around rbp

(kgdb) x/64gx $rbp-0x100
0xfffffe005191abc0: 0x4141414141414141 0x4141414141414141
0xfffffe005191abd0: 0x4141414141414141 0x4141414141414141
0xfffffe005191abe0: 0x4141414141414141 0x4141414141414141 0xfffffe005191abf0: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac00: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac10: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac20: 0x4141414141414141 0x4141414141414141 0xfffffe005191ac30: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac40: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac50: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac60: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac70: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac80: 0x4141414141414141 0x4141414141414141
0xfffffe005191ac90: 0x14e30ff1b72bde44 0x4141414141414141
0xfffffe005191aca0: 0x4141414141414141 0x00001aff6be13400
0xfffffe005191acb0: 0x4141414141414141 0x4141414141414141
0xfffffe005191acc0: 0x4141414141414141 0xffffffff80af5b26
0xfffffe005191acd0: 0xffffffff828648d0 0xfffffe005191ada8
0xfffffe005191ace0: 0xfffffe005191ad40 0xffffffff809c7d3a
0xfffffe005191acf0: 0x0000000000000000 0x0000000000000b50
0xfffffe005191ad00: 0x0000000100000000 0xfffff8000a6cc400
0xfffffe005191ad10: 0x000000005191add0 0xfffff8000a2da000
0xfffffe005191ad20: 0xfffffe005191ada8 0xfffff8000a5c5cd0
0xfffffe005191ad30: 0x0000000000000000 0x0000000000000b50
0xfffffe005191ad40: 0xfffffe005191ad90 0xffffffff80b95bf1
0xfffffe005191ad50: 0xfffffe005191ade8 0x0000000000000000
0xfffffe005191ad60: 0x000000035191ad90 0xfffff8000a2da000
0xfffffe005191ad70: 0xfffffe00043afae0 0x0000000000000000
0xfffffe005191ad80: 0x0000000000000003 0xffffffff818c1650
0xfffffe005191ad90: 0xfffffe005191ae00 0xffffffff80b957a3
0xfffffe005191ada0: 0x0000000000000002 0xfffffe005191add8
0xfffffe005191adb0: 0xfffffe0000000001 0x0000000000000b50

(kgdb) x/64gx $rbp
0xfffffe005191acc0: 0x4141414141414141 0xffffffff80af5b26
0xfffffe005191acd0: 0xffffffff828648d0 0xfffffe005191ada8
0xfffffe005191ace0: 0xfffffe005191ad40 0xffffffff809c7d3a 0xfffffe005191acf0: 0x0000000000000000 0x0000000000000b50
0xfffffe005191ad00: 0x0000000100000000 0xfffff8000a6cc400
0xfffffe005191ad10: 0x000000005191add0 0xfffff8000a2da000
0xfffffe005191ad20: 0xfffffe005191ada8 0xfffff8000a5c5cd0 0xfffffe005191ad30: 0x0000000000000000 0x0000000000000b50
0xfffffe005191ad40: 0xfffffe005191ad90 0xffffffff80b95bf1
0xfffffe005191ad50: 0xfffffe005191ade8 0x0000000000000000
0xfffffe005191ad60: 0x000000035191ad90 0xfffff8000a2da000
0xfffffe005191ad70: 0xfffffe00043afae0 0x0000000000000000
0xfffffe005191ad80: 0x0000000000000003 0xffffffff818c1650
0xfffffe005191ad90: 0xfffffe005191ae00 0xffffffff80b957a3
0xfffffe005191ada0: 0x0000000000000002 0xfffffe005191add8
0xfffffe005191adb0: 0xfffffe0000000001 0x0000000000000b50
0xfffffe005191adc0: 0x0000000000000000 0x0000000100000000
0xfffffe005191add0: 0xfffff8000a2da000 0x00001aff6be13b50
0xfffffe005191ade0: 0x0000000000000000 0xfffff8000a5c5cd0
0xfffffe005191adf0: 0xfffff8000a2da000 0x0000000000000001
0xfffffe005191ae00: 0xfffffe005191af30 0xffffffff80fed407
0xfffffe005191ae10: 0xfffffe005191af30 0xffffffff80fec514
0xfffffe005191ae20: 0x0000000000000000 0x000003d00b1c5b98
0xfffffe005191ae30: 0xfffffe005191aef0 0xffffffff80b92186
0xfffffe005191ae40: 0xffffffff818d9788 0x0000000000000000
0xfffffe005191ae50: 0xffffffff81c32c00 0x0000000000000003
0xfffffe005191ae60: 0x00000000000003e8 0x0000000000000423
0xfffffe005191ae70: 0xffffffff81c32c00 0xfffff8000a2da000
0xfffffe005191ae80: 0xfffff8000a2da000 0xffffffff818c1650
0xfffffe005191ae90: 0xfffffe005191aeb0 0x0000000000000246
0xfffffe005191aea0: 0x0000000000000000 0x0000000000000000
0xfffffe005191aeb0: 0xffffffff81102f87 0xffffffff81135edf

(kgdb) x/64gx $rbp+0x40
0xfffffe005191ad00: 0x0000000100000000 0xfffff8000a6cc400
0xfffffe005191ad10: 0x000000005191add0 0xfffff8000a2da000
0xfffffe005191ad20: 0xfffffe005191ada8 0xfffff8000a5c5cd0 0xfffffe005191ad30: 0x0000000000000000 0x0000000000000b50
0xfffffe005191ad40: 0xfffffe005191ad90 0xffffffff80b95bf1
0xfffffe005191ad50: 0xfffffe005191ade8 0x0000000000000000
0xfffffe005191ad60: 0x000000035191ad90 0xfffff8000a2da000 0xfffffe005191ad70: 0xfffffe00043afae0 0x0000000000000000
0xfffffe005191ad80: 0x0000000000000003 0xffffffff818c1650
0xfffffe005191ad90: 0xfffffe005191ae00 0xffffffff80b957a3
0xfffffe005191ada0: 0x0000000000000002 0xfffffe005191add8
0xfffffe005191adb0: 0xfffffe0000000001 0x0000000000000b50
0xfffffe005191adc0: 0x0000000000000000 0x0000000100000000
0xfffffe005191add0: 0xfffff8000a2da000 0x00001aff6be13b50
0xfffffe005191ade0: 0x0000000000000000 0xfffff8000a5c5cd0
0xfffffe005191adf0: 0xfffff8000a2da000 0x0000000000000001
0xfffffe005191ae00: 0xfffffe005191af30 0xffffffff80fed407
0xfffffe005191ae10: 0xfffffe005191af30 0xffffffff80fec514
0xfffffe005191ae20: 0x0000000000000000 0x000003d00b1c5b98
0xfffffe005191ae30: 0xfffffe005191aef0 0xffffffff80b92186
0xfffffe005191ae40: 0xffffffff818d9788 0x0000000000000000
0xfffffe005191ae50: 0xffffffff81c32c00 0x0000000000000003
0xfffffe005191ae60: 0x00000000000003e8 0x0000000000000423
0xfffffe005191ae70: 0xffffffff81c32c00 0xfffff8000a2da000
0xfffffe005191ae80: 0xfffff8000a2da000 0xffffffff818c1650
0xfffffe005191ae90: 0xfffffe005191aeb0 0x0000000000000246
0xfffffe005191aea0: 0x0000000000000000 0x0000000000000000
0xfffffe005191aeb0: 0xffffffff81102f87 0xffffffff81135edf
0xfffffe005191aec0: 0x0000000000000002 0xfffff8000a2da000
0xfffffe005191aed0: 0x00001aff6ba00088 0x0000000820ac54b8
0xfffffe005191aee0: 0x0000000000000003 0x000003d00b1c5b98
0xfffffe005191aef0: 0xfffffe005191af30 0xffffffff80b88339

# Around the buffer itself

## big byte-level view of data[] and beyond

(kgdb) x/256bx $rbp-0xb20
0xfffffe005191a1a0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1a8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1b0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0xfffffe005191a1b8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1c0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1c8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1d0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0xfffffe005191a1d8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1e0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1e8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1f0: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a1f8: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a200: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a208: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a210: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a218: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a220: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a228: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a230: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a238: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a240: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a248: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a250: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a258: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a260: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a268: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a270: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a278: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a280: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a288: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a290: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41
0xfffffe005191a298: 0x41 0x41 0x41 0x41 0x41 0x41 0x41 0x41

## Same in 8-byte chunks

(kgdb) x/64gx $rbp-0xb20
0xfffffe005191a1a0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a1b0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a1c0: 0x4141414141414141 0x4141414141414141 0xfffffe005191a1d0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a1e0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a1f0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a200: 0x4141414141414141 0x4141414141414141 0xfffffe005191a210: 0x4141414141414141 0x4141414141414141
0xfffffe005191a220: 0x4141414141414141 0x4141414141414141
0xfffffe005191a230: 0x4141414141414141 0x4141414141414141
0xfffffe005191a240: 0x4141414141414141 0x4141414141414141
0xfffffe005191a250: 0x4141414141414141 0x4141414141414141
0xfffffe005191a260: 0x4141414141414141 0x4141414141414141
0xfffffe005191a270: 0x4141414141414141 0x4141414141414141
0xfffffe005191a280: 0x4141414141414141 0x4141414141414141
0xfffffe005191a290: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2a0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2b0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2c0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2d0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2e0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a2f0: 0x4141414141414141 0x4141414141414141
0xfffffe005191a300: 0x4141414141414141 0x4141414141414141
0xfffffe005191a310: 0x4141414141414141 0x4141414141414141
0xfffffe005191a320: 0x4141414141414141 0x4141414141414141
0xfffffe005191a330: 0x4141414141414141 0x4141414141414141
0xfffffe005191a340: 0x4141414141414141 0x4141414141414141
0xfffffe005191a350: 0x4141414141414141 0x4141414141414141
0xfffffe005191a360: 0x4141414141414141 0x4141414141414141
0xfffffe005191a370: 0x4141414141414141 0x4141414141414141
0xfffffe005191a380: 0x4141414141414141 0x4141414141414141
0xfffffe005191a390: 0x4141414141414141 0x4141414141414141

# Correct offset computations

## offset from data to saved rbp

```
(kgdb) p/x (char _)$rbp - (char _)&data
$16 = 0xb20
```

## offset from data to saved rip

```
(kgdb) p/x (char _)$rbp + 8 - (char _)&data
$17 = 0xb28
```
